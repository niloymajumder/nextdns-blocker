# NextDNS Blocker - Docker Compose Configuration
#
# Setup:
#   1. Copy .env.example to .env
#   2. Edit .env with your NextDNS credentials
#   3. Run: docker compose up -d

services:
  nextdns-blocker:
    build: .
    container_name: nextdns-blocker
    restart: unless-stopped
    env_file:
      - .env
    environment:
      # Required: NextDNS API credentials
      - NEXTDNS_API_KEY=${NEXTDNS_API_KEY}
      - NEXTDNS_PROFILE_ID=${NEXTDNS_PROFILE_ID}
      # Optional: Remote domains configuration
      - DOMAINS_URL=${DOMAINS_URL:-}
      # Optional: Timezone (default: America/Mexico_City)
      - TZ=${TZ:-America/Mexico_City}
    volumes:
      # Mount domains.json for local configuration (optional if using DOMAINS_URL)
      - ./domains.json:/app/domains.json:ro
      # Persist logs
      - nextdns-logs:/home/blocker/.local/share/nextdns-blocker/logs
    # Run watchdog which manages sync cron jobs
    command: ["nextdns-blocker", "watchdog", "check"]

volumes:
  nextdns-logs:
    name: nextdns-blocker-logs
